d6940e799aa713e0161b7c4ae8d8bc05
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createAnimatedOperator = createAnimatedOperator;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _AnimatedNode2 = _interopRequireDefault(require("./AnimatedNode"));

var _val = require("../val");

var _invariant = _interopRequireDefault(require("fbjs/lib/invariant"));

var _AnimatedBlock = require("../core/AnimatedBlock");

function reduce(fn) {
  return function (input) {
    return input.reduce(function (a, b) {
      return fn((0, _val.val)(a), (0, _val.val)(b));
    });
  };
}

function reduceFrom(fn, initialValue) {
  return function (input) {
    return input.reduce(function (a, b) {
      return fn((0, _val.val)(a), (0, _val.val)(b));
    }, initialValue);
  };
}

function infix(fn) {
  return function (input) {
    return fn((0, _val.val)(input[0]), (0, _val.val)(input[1]));
  };
}

function single(fn) {
  return function (input) {
    return fn((0, _val.val)(input[0]));
  };
}

var OPERATIONS = {
  add: reduce(function (a, b) {
    return a + b;
  }),
  sub: reduce(function (a, b) {
    return a - b;
  }),
  multiply: reduce(function (a, b) {
    return a * b;
  }),
  divide: reduce(function (a, b) {
    return a / b;
  }),
  pow: reduce(function (a, b) {
    return Math.pow(a, b);
  }),
  modulo: reduce(function (a, b) {
    return (a % b + b) % b;
  }),
  sqrt: single(function (a) {
    return Math.sqrt(a);
  }),
  log: single(function (a) {
    return Math.log(a);
  }),
  sin: single(function (a) {
    return Math.sin(a);
  }),
  cos: single(function (a) {
    return Math.cos(a);
  }),
  tan: single(function (a) {
    return Math.tan(a);
  }),
  acos: single(function (a) {
    return Math.acos(a);
  }),
  asin: single(function (a) {
    return Math.asin(a);
  }),
  atan: single(function (a) {
    return Math.atan(a);
  }),
  exp: single(function (a) {
    return Math.exp(a);
  }),
  round: single(function (a) {
    return Math.round(a);
  }),
  and: reduceFrom(function (a, b) {
    return a && b;
  }, true),
  or: reduceFrom(function (a, b) {
    return a || b;
  }, false),
  not: single(function (a) {
    return !a;
  }),
  defined: single(function (a) {
    return a !== null && a !== undefined && !isNaN(a);
  }),
  lessThan: infix(function (a, b) {
    return a < b;
  }),
  eq: infix(function (a, b) {
    return a == b;
  }),
  greaterThan: infix(function (a, b) {
    return a > b;
  }),
  lessOrEq: infix(function (a, b) {
    return a <= b;
  }),
  greaterOrEq: infix(function (a, b) {
    return a >= b;
  }),
  neq: infix(function (a, b) {
    return a != b;
  })
};

var AnimatedOperator = function (_AnimatedNode) {
  (0, _inherits2.default)(AnimatedOperator, _AnimatedNode);

  function AnimatedOperator(operator, input) {
    var _this;

    (0, _classCallCheck2.default)(this, AnimatedOperator);
    _this = (0, _possibleConstructorReturn2.default)(this, (0, _getPrototypeOf2.default)(AnimatedOperator).call(this, {
      type: 'op',
      op: operator,
      input: input.map(function (n) {
        return n.__nodeID;
      })
    }, input));
    _this._op = operator;
    _this._input = input;
    return _this;
  }

  (0, _createClass2.default)(AnimatedOperator, [{
    key: "__onEvaluate",
    value: function __onEvaluate() {
      if (!this._operation) {
        this._operation = OPERATIONS[this._op];
        (0, _invariant.default)(this._operation, "Illegal operator '%s'", this._op);
      }

      return this._operation(this._input);
    }
  }]);
  return AnimatedOperator;
}(_AnimatedNode2.default);

function createAnimatedOperator(name) {
  return function () {
    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    return new AnimatedOperator(name, args.map(_AnimatedBlock.adapt));
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFuaW1hdGVkT3BlcmF0b3IuanMiXSwibmFtZXMiOlsicmVkdWNlIiwiZm4iLCJpbnB1dCIsImEiLCJiIiwicmVkdWNlRnJvbSIsImluaXRpYWxWYWx1ZSIsImluZml4Iiwic2luZ2xlIiwiT1BFUkFUSU9OUyIsImFkZCIsInN1YiIsIm11bHRpcGx5IiwiZGl2aWRlIiwicG93IiwiTWF0aCIsIm1vZHVsbyIsInNxcnQiLCJsb2ciLCJzaW4iLCJjb3MiLCJ0YW4iLCJhY29zIiwiYXNpbiIsImF0YW4iLCJleHAiLCJyb3VuZCIsImFuZCIsIm9yIiwibm90IiwiZGVmaW5lZCIsInVuZGVmaW5lZCIsImlzTmFOIiwibGVzc1RoYW4iLCJlcSIsImdyZWF0ZXJUaGFuIiwibGVzc09yRXEiLCJncmVhdGVyT3JFcSIsIm5lcSIsIkFuaW1hdGVkT3BlcmF0b3IiLCJvcGVyYXRvciIsInR5cGUiLCJvcCIsIm1hcCIsIm4iLCJfX25vZGVJRCIsIl9vcCIsIl9pbnB1dCIsIl9vcGVyYXRpb24iLCJBbmltYXRlZE5vZGUiLCJjcmVhdGVBbmltYXRlZE9wZXJhdG9yIiwibmFtZSIsImFyZ3MiLCJhZGFwdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFFQSxTQUFTQSxNQUFULENBQWdCQyxFQUFoQixFQUFvQjtBQUNsQixTQUFPLFVBQUFDLEtBQUs7QUFBQSxXQUFJQSxLQUFLLENBQUNGLE1BQU4sQ0FBYSxVQUFDRyxDQUFELEVBQUlDLENBQUo7QUFBQSxhQUFVSCxFQUFFLENBQUMsY0FBSUUsQ0FBSixDQUFELEVBQVMsY0FBSUMsQ0FBSixDQUFULENBQVo7QUFBQSxLQUFiLENBQUo7QUFBQSxHQUFaO0FBQ0Q7O0FBRUQsU0FBU0MsVUFBVCxDQUFvQkosRUFBcEIsRUFBd0JLLFlBQXhCLEVBQXNDO0FBQ3BDLFNBQU8sVUFBQUosS0FBSztBQUFBLFdBQUlBLEtBQUssQ0FBQ0YsTUFBTixDQUFhLFVBQUNHLENBQUQsRUFB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QUFDLEtBQUtxQyxHQUFOLENBQTVCO0FBQ0EsZ0NBQVUsS0FBS0UsVUFBZiwyQkFBb0QsS0FBS0YsR0FBekQ7QUFDRDs7QUFDRCxhQUFPLEtBQUtFLFVBQUwsQ0FBZ0IsS0FBS0QsTUFBckIsQ0FBUDtBQUNEOzs7RUFwQjRCRSxzQjs7QUF1QnhCLFNBQVNDLHNCQUFULENBQWdDQyxJQUFoQyxFQUFzQztBQUMzQyxTQUFPO0FBQUEsc0NBQUlDLElBQUo7QUFBSUEsTUFBQUEsSUFBSjtBQUFBOztBQUFBLFdBQWEsSUFBSWIsZ0JBQUosQ0FBcUJZLElBQXJCLEVBQTJCQyxJQUFJLENBQUNULEdBQUwsQ0FBU1Usb0JBQVQsQ0FBM0IsQ0FBYjtBQUFBLEdBQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBBbmltYXRlZE5vZGUgZnJvbSAnLi9BbmltYXRlZE5vZGUnO1xuaW1wb3J0IHsgdmFsIH0gZnJvbSAnLi4vdmFsJztcblxuaW1wb3J0IGludmFyaWFudCBmcm9tICdmYmpzL2xpYi9pbnZhcmlhbnQnO1xuaW1wb3J0IHsgYWRhcHQgfSBmcm9tICcuLi9jb3JlL0FuaW1hdGVkQmxvY2snO1xuXG5mdW5jdGlvbiByZWR1Y2UoZm4pIHtcbiAgcmV0dXJuIGlucHV0ID0+IGlucHV0LnJlZHVjZSgoYSwgYikgPT4gZm4odmFsKGEpLCB2YWwoYikpKTtcbn1cblxuZnVuY3Rpb24gcmVkdWNlRnJvbShmbiwgaW5pdGlhbFZhbHVlKSB7XG4gIHJldHVybiBpbnB1dCA9PiBpbnB1dC5yZWR1Y2UoKGEsIGIpID0+IGZuKHZhbChhKSwgdmFsKGIpKSwgaW5pdGlhbFZhbHVlKTtcbn1cblxuZnVuY3Rpb24gaW5maXgoZm4pIHtcbiAgcmV0dXJuIGlucHV0ID0+IGZuKHZhbChpbnB1dFswXSksIHZhbChpbnB1dFsxXSkpO1xufVxuXG5mdW5jdGlvbiBzaW5nbGUoZm4pIHtcbiAgcmV0dXJuIGlucHV0ID0+IGZuKHZhbChpbnB1dFswXSkpO1xufVxuXG5jb25zdCBPUEVSQVRJT05TID0ge1xuICAvLyBhcml0aG1ldGljXG4gIGFkZDogcmVkdWNlKChhLCBiKSA9PiBhICsgYiksXG4gIHN1YjogcmVkdWNlKChhLCBiKSA9PiBhIC0gYiksXG4gIG11bHRpcGx5OiByZWR1Y2UoKGEsIGIpID0+IGEgKiBiKSxcbiAgZGl2aWRlOiByZWR1Y2UoKGEsIGIpID0+IGEgLyBiKSxcbiAgcG93OiByZWR1Y2UoKGEsIGIpID0+IE1hdGgucG93KGEsIGIpKSxcbiAgbW9kdWxvOiByZWR1Y2UoKGEsIGIpID0+ICgoYSAlIGIpICsgYikgJSBiKSxcbiAgc3FydDogc2luZ2xlKGEgPT4gTWF0aC5zcXJ0KGEpKSxcbiAgbG9nOiBzaW5nbGUoYSA9PiBNYXRoLmxvZyhhKSksXG4gIHNpbjogc2luZ2xlKGEgPT4gTWF0aC5zaW4oYSkpLFxuICBjb3M6IHNpbmdsZShhID0+IE1hdGguY29zKGEpKSxcbiAgdGFuOiBzaW5nbGUoYSA9PiBNYXRoLnRhbihhKSksXG4gIGFjb3M6IHNpbmdsZShhID0+IE1hdGguYWNvcyhhKSksXG4gIGFzaW46IHNpbmdsZShhID0+IE1hdGguYXNpbihhKSksXG4gIGF0YW46IHNpbmdsZShhID0+IE1hdGguYXRhbihhKSksXG4gIGV4cDogc2luZ2xlKGEgPT4gTWF0aC5leHAoYSkpLFxuICByb3VuZDogc2luZ2xlKGEgPT4gTWF0aC5yb3VuZChhKSksXG5cbiAgLy8gbG9naWNhbFxuICBhbmQ6IHJlZHVjZUZyb20oKGEsIGIpID0+IGEgJiYgYiwgdHJ1ZSksXG4gIG9yOiByZWR1Y2VGcm9tKChhLCBiKSA9PiBhIHx8IGIsIGZhbHNlKSxcbiAgbm90OiBzaW5nbGUoYSA9PiAhYSksXG4gIGRlZmluZWQ6IHNpbmdsZShhID0+IGEgIT09IG51bGwgJiYgYSAhPT0gdW5kZWZpbmVkICYmICFpc05hTihhKSksXG5cbiAgLy8gY29tcGFyaW5nXG4gIGxlc3NUaGFuOiBpbmZpeCgoYSwgYikgPT4gYSA8IGIpLFxuICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXFlcWVxICovXG4gIGVxOiBpbmZpeCgoYSwgYikgPT4gYSA9PSBiKSxcbiAgZ3JlYXRlclRoYW46IGluZml4KChhLCBiKSA9PiBhID4gYiksXG4gIGxlc3NPckVxOiBpbmZpeCgoYSwgYikgPT4gYSA8PSBiKSxcbiAgZ3JlYXRlck9yRXE6IGluZml4KChhLCBiKSA9PiBhID49IGIpLFxuICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXFlcWVxICovXG4gIG5lcTogaW5maXgoKGEsIGIpID0+IGEgIT0gYiksXG59O1xuXG5jbGFzcyBBbmltYXRlZE9wZXJhdG9yIGV4dGVuZHMgQW5pbWF0ZWROb2RlIHtcbiAgX2lucHV0O1xuICBfb3A7XG4gIF9vcGVyYXRpb247XG5cbiAgY29uc3RydWN0b3Iob3BlcmF0b3IsIGlucHV0KSB7XG4gICAgc3VwZXIoXG4gICAgICB7IHR5cGU6ICdvcCcsIG9wOiBvcGVyYXRvciwgaW5wdXQ6IGlucHV0Lm1hcChuID0+IG4uX19ub2RlSUQpIH0sXG4gICAgICBpbnB1dFxuICAgICk7XG4gICAgdGhpcy5fb3AgPSBvcGVyYXRvcjtcbiAgICB0aGlzLl9pbnB1dCA9IGlucHV0O1xuICB9XG5cbiAgX19vbkV2YWx1YXRlKCkge1xuICAgIGlmICghdGhpcy5fb3BlcmF0aW9uKSB7XG4gICAgICB0aGlzLl9vcGVyYXRpb24gPSBPUEVSQVRJT05TW3RoaXMuX29wXTtcbiAgICAgIGludmFyaWFudCh0aGlzLl9vcGVyYXRpb24sIGBJbGxlZ2FsIG9wZXJhdG9yICclcydgLCB0aGlzLl9vcCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9vcGVyYXRpb24odGhpcy5faW5wdXQpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVBbmltYXRlZE9wZXJhdG9yKG5hbWUpIHtcbiAgcmV0dXJuICguLi5hcmdzKSA9PiBuZXcgQW5pbWF0ZWRPcGVyYXRvcihuYW1lLCBhcmdzLm1hcChhZGFwdCkpO1xufVxuIl19