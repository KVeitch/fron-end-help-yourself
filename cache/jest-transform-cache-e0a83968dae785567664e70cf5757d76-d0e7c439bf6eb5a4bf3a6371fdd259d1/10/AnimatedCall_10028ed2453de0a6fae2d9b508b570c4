169f745a30b4691f27e5f6c53d3f75c5
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createAnimatedCall = createAnimatedCall;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _get2 = _interopRequireDefault(require("@babel/runtime/helpers/get"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _ReanimatedEventEmitter = _interopRequireDefault(require("../ReanimatedEventEmitter"));

var _val = require("../val");

var _AnimatedNode2 = _interopRequireDefault(require("./AnimatedNode"));

var NODE_MAPPING = new Map();

function listener(data) {
  var node = NODE_MAPPING.get(data.id);
  node && node._callback(data.args);
}

var AnimatedCall = function (_AnimatedNode) {
  (0, _inherits2.default)(AnimatedCall, _AnimatedNode);

  function AnimatedCall(args, jsFunction) {
    var _this;

    (0, _classCallCheck2.default)(this, AnimatedCall);
    _this = (0, _possibleConstructorReturn2.default)(this, (0, _getPrototypeOf2.default)(AnimatedCall).call(this, {
      type: 'call',
      input: args.map(function (n) {
        return n.__nodeID;
      })
    }, args));
    _this._callback = jsFunction;
    _this._args = args;
    return _this;
  }

  (0, _createClass2.default)(AnimatedCall, [{
    key: "__attach",
    value: function __attach() {
      (0, _get2.default)((0, _getPrototypeOf2.default)(AnimatedCall.prototype), "__attach", this).call(this);
      NODE_MAPPING.set(this.__nodeID, this);

      if (NODE_MAPPING.size === 1) {
        _ReanimatedEventEmitter.default.addListener('onReanimatedCall', listener);
      }
    }
  }, {
    key: "__detach",
    value: function __detach() {
      NODE_MAPPING.delete(this.__nodeID);

      if (NODE_MAPPING.size === 0) {
        _ReanimatedEventEmitter.default.removeAllListeners('onReanimatedCall');
      }

      (0, _get2.default)((0, _getPrototypeOf2.default)(AnimatedCall.prototype), "__detach", this).call(this);
    }
  }, {
    key: "__onEvaluate",
    value: function __onEvaluate() {
      this._callback(this._args.map(_val.val));

      return 0;
    }
  }]);
  return AnimatedCall;
}(_AnimatedNode2.default);

function createAnimatedCall(args, func) {
  return new AnimatedCall(args, func);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFuaW1hdGVkQ2FsbC5qcyJdLCJuYW1lcyI6WyJOT0RFX01BUFBJTkciLCJNYXAiLCJsaXN0ZW5lciIsImRhdGEiLCJub2RlIiwiZ2V0IiwiaWQiLCJfY2FsbGJhY2siLCJhcmdzIiwiQW5pbWF0ZWRDYWxsIiwianNGdW5jdGlvbiIsInR5cGUiLCJpbnB1dCIsIm1hcCIsIm4iLCJfX25vZGVJRCIsIl9hcmdzIiwic2V0Iiwic2l6ZSIsIlJlYW5pbWF0ZWRFdmVudEVtaXR0ZXIiLCJhZGRMaXN0ZW5lciIsImRlbGV0ZSIsInJlbW92ZUFsbExpc3RlbmVycyIsInZhbCIsIkFuaW1hdGVkTm9kZSIsImNyZWF0ZUFuaW1hdGVkQ2FsbCIsImZ1bmMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFFQSxJQUFNQSxZQUFZLEdBQUcsSUFBSUMsR0FBSixFQUFyQjs7QUFFQSxTQUFTQyxRQUFULENBQWtCQyxJQUFsQixFQUF3QjtBQUN0QixNQUFNQyxJQUFJLEdBQUdKLFlBQVksQ0FBQ0ssR0FBYixDQUFpQkYsSUFBSSxDQUFDRyxFQUF0QixDQUFiO0FBQ0FGLEVBQUFBLElBQUksSUFBSUEsSUFBSSxDQUFDRyxTQUFMLENBQWVKLElBQUksQ0FBQ0ssSUFBcEIsQ0FBUjtBQUNEOztJQUVLQyxZOzs7QUFJSix3QkFBWUQsSUFBWixFQUFrQkUsVUFBbEIsRUFBOEI7QUFBQTs7QUFBQTtBQUM1QixrSEFBTTtBQUFFQyxNQUFBQSxJQUFJLEVBQUUsTUFBUjtBQUFnQkMsTUFBQUEsS0FBSyxFQUFFSixJQUFJLENBQUNLLEdBQUwsQ0FBUyxVQUFBQyxDQUFDO0FBQUEsZUFBSUEsQ0FBQyxDQUFDQyxRQUFOO0FBQUEsT0FBVjtBQUF2QixLQUFOLEVBQTBEUCxJQUExRDtBQUNBLFVBQUtELFNBQUwsR0FBaUJHLFVBQWpCO0FBQ0EsVUFBS00sS0FBTCxHQUFhUixJQUFiO0FBSDRCO0FBSTdCOzs7OytCQUVVO0FBQ1Q7QUFDQVIsTUFBQUEsWUFBWSxDQUFDaUIsR0FBYixDQUFpQixLQUFLRixRQUF0QixFQUFnQyxJQUFoQzs7QUFDQSxVQUFJZixZQUFZLENBQUNrQixJQUFiLEtBQXNCLENBQTFCLEVBQTZCO0FBQzNCQyx3Q0FBdUJDLFdBQXZCLENBQW1DLGtCQUFuQyxFQUF1RGxCLFFBQXZEO0FBQ0Q7QUFDRjs7OytCQUVVO0FBQ1RGLE1BQUFBLFlBQVksQ0FBQ3FCLE1BQWIsQ0FBb0IsS0FBS04sUUFBekI7O0FBQ0EsVUFBSWYsWUFBWSxDQUFDa0IsSUFBYixLQUFzQixDQUExQixFQUE2QjtBQUMzQkMsd0NBQXVCRyxrQkFBdkIsQ0FBMEMsa0JBQTFDO0FBQ0Q7O0FBQ0Q7QUFDRDs7O21DQUVjO0FBQ2IsV0FBS2YsU0FBTCxDQUFlLEtBQUtTLEtBQUwsQ0FBV0gsR0FBWCxDQUFlVSxRQUFmLENBQWY7O0FBQ0EsYUFBTyxDQUFQO0FBQ0Q7OztFQTdCd0JDLHNCOztBQWdDcEIsU0FBU0Msa0JBQVQsQ0FBNEJqQixJQUE1QixFQUFrQ2tCLElBQWxDLEVBQXdDO0FBQzdDLFNBQU8sSUFBSWpCLFlBQUosQ0FBaUJELElBQWpCLEVBQXVCa0IsSUFBdkIsQ0FBUDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYW5pbWF0ZWRFdmVudEVtaXR0ZXIgZnJvbSAnLi4vUmVhbmltYXRlZEV2ZW50RW1pdHRlcic7XG5pbXBvcnQgeyB2YWwgfSBmcm9tICcuLi92YWwnO1xuaW1wb3J0IEFuaW1hdGVkTm9kZSBmcm9tICcuL0FuaW1hdGVkTm9kZSc7XG5cbmNvbnN0IE5PREVfTUFQUElORyA9IG5ldyBNYXAoKTtcblxuZnVuY3Rpb24gbGlzdGVuZXIoZGF0YSkge1xuICBjb25zdCBub2RlID0gTk9ERV9NQVBQSU5HLmdldChkYXRhLmlkKTtcbiAgbm9kZSAmJiBub2RlLl9jYWxsYmFjayhkYXRhLmFyZ3MpO1xufVxuXG5jbGFzcyBBbmltYXRlZENhbGwgZXh0ZW5kcyBBbmltYXRlZE5vZGUge1xuICBfY2FsbGJhY2s7XG4gIF9hcmdzO1xuXG4gIGNvbnN0cnVjdG9yKGFyZ3MsIGpzRnVuY3Rpb24pIHtcbiAgICBzdXBlcih7IHR5cGU6ICdjYWxsJywgaW5wdXQ6IGFyZ3MubWFwKG4gPT4gbi5fX25vZGVJRCkgfSwgYXJncyk7XG4gICAgdGhpcy5fY2FsbGJhY2sgPSBqc0Z1bmN0aW9uO1xuICAgIHRoaXMuX2FyZ3MgPSBhcmdzO1xuICB9XG5cbiAgX19hdHRhY2goKSB7XG4gICAgc3VwZXIuX19hdHRhY2goKTtcbiAgICBOT0RFX01BUFBJTkcuc2V0KHRoaXMuX19ub2RlSUQsIHRoaXMpO1xuICAgIGlmIChOT0RFX01BUFBJTkcuc2l6ZSA9PT0gMSkge1xuICAgICAgUmVhbmltYXRlZEV2ZW50RW1pdHRlci5hZGRMaXN0ZW5lcignb25SZWFuaW1hdGVkQ2FsbCcsIGxpc3RlbmVyKTtcbiAgICB9XG4gIH1cblxuICBfX2RldGFjaCgpIHtcbiAgICBOT0RFX01BUFBJTkcuZGVsZXRlKHRoaXMuX19ub2RlSUQpO1xuICAgIGlmIChOT0RFX01BUFBJTkcuc2l6ZSA9PT0gMCkge1xuICAgICAgUmVhbmltYXRlZEV2ZW50RW1pdHRlci5yZW1vdmVBbGxMaXN0ZW5lcnMoJ29uUmVhbmltYXRlZENhbGwnKTtcbiAgICB9XG4gICAgc3VwZXIuX19kZXRhY2goKTtcbiAgfVxuXG4gIF9fb25FdmFsdWF0ZSgpIHtcbiAgICB0aGlzLl9jYWxsYmFjayh0aGlzLl9hcmdzLm1hcCh2YWwpKTtcbiAgICByZXR1cm4gMDtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQW5pbWF0ZWRDYWxsKGFyZ3MsIGZ1bmMpIHtcbiAgcmV0dXJuIG5ldyBBbmltYXRlZENhbGwoYXJncywgZnVuYyk7XG59XG4iXX0=